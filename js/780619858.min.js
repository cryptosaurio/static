angular.module("app",["ngSanitize","ngRoute","ngMaterial","ngMessages","ngMdIcons","ngclipboard","angular.snackbar","star-rating","afklStickyElement","angularPagination","ngLocationUpdate","fayzaan.gRecaptcha.v3"]).config(["$provide","$compileProvider","$mdThemingProvider","$sceDelegateProvider","$locationProvider","$mdAriaProvider",function(e,t,i,n,r,a){t.debugInfoEnabled(!1),i.disableTheming(!0),a.disableWarnings(),e.decorator("$exceptionHandler",["$delegate",function(i){return function(e,t){i(e,t),reportError(JSON.stringify({exception:"object"==typeof e?e.stack:""+e,cause:""+t}))}}]),n.resourceUrlWhitelist(["https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@**","**/partials/*"]),r.html5Mode(!0)}]);var e=angular.module("app");e.controller("ReviewsController",["$scope","$window","$location","$http","$timeout","$mdDialog","Pagination","gRecaptcha","commonFunctionsService",function(n,r,a,o,e,t,i,s,l){n.tooltipCopySuccessful=l.tooltipCopySuccessful,n.track=l.track,n.trackSystem=l.trackSystem,n.showCountriesMenu=l.showCountriesMenu,n.redirectTo=function(e){r.open(e,"_blank")},n.hideNews=function(e){return!!JSON.parse(r.localStorage.getItem(e+"_gift_news_closed"))||!1},n.closeNews=function(e,t){r.localStorage.setItem(e+"_gift_news_closed",!0)},s.initialize({key:"6Le6vr8ZAAAAAH6G2kvLs-VDT1cKIa_UGepnpMBI"});function c(e){u=e}var u=!(n.showDialogButtonEnabled=!0);n.showReviewSubmitDialog=function(e){n.showDialogButtonEnabled&&(n.showDialogButtonEnabled=!1,t.show({controller:"ReviewSubmitDialogController",templateUrl:"/"+r.COUNTRY+"/partials/review-submit-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,locals:{extraParameters:{providerSelected:n.providerSelected,context:"review-page"},changeSubmittedState:c,gRecaptchaV3:s},onComplete:function(){n.showDialogButtonEnabled=!0},onRemoving:function(e,t){u&&n.fetchReviewsWhenChangeOrderByOption("br"==r.COUNTRY?"mais-recentes":"mas-recientes",!0)}}))},n.fetchReviewsWhenChangeOrderByOption=function(e,t){n.orderByOption.option=e,n.pagination=i.create({itemsPerPage:5,itemsCount:n.reviewsCount,maxNumbers:5,currentPage:1}),n.changeReviewsPage(1,void 0,t)},n.fetchReviews=function(e){e=e||1,o.get(r.BARNEY_ENDPOINT+"/reviews/"+n.providerSelected+"/"+n.orderByOption.option+"/"+e).then(function(e){n.reviews=e.data},function(){})},e(function(){n.pagination=i.create({itemsPerPage:5,itemsCount:n.reviewsCount,maxNumbers:5,currentPage:n.page}),n.fetchReviews(n.page)},0),n.getReviews=function(){return n.reviews},n.getPageUrl=function(e){return"/"+r.COUNTRY+"/opiniones/"+n.providerSelected+"/"+n.orderByOption.option+"/"+e},n.changeReviewsPage=function(e,t,i){t&&t.preventDefault(),a.path()==n.getPageUrl(e)&&!i||(a.update_path(n.getPageUrl(e),!1),n.fetchReviews(e))},n.vote=function(i,n){("upvote"==n&&!i.already_upvoted||"downvote"==n&&!i.already_downvoted)&&("upvote"==n?(i.already_upvoted=!0,i.upvoted+=1):"downvote"==n&&(i.already_downvoted=!0,i.downvoted+=1),s.execute({action:"vote_review"}).then(function(e){var t=r.BARNEY_ENDPOINT+"/"+r.COUNTRY+"/review/";"br"!=r.COUNTRY&&(t=r.BARNEY_ENDPOINT+"/review/"),o.patch(t,{id:i.pk,operation_type:n,captcha_response:e})}))}}]),(e=angular.module("app")).controller("ReviewSubmitDialogController",["$scope","$window","$timeout","$http","$mdDialog","extraParameters","changeSubmittedState","gRecaptchaV3",function(i,t,n,r,e,a,o,s){i.step1=!0,i.step2=!1,i.context=a.context,i.providerSelected=a.providerSelected,i.answers={provider_id:a.providerSelected,review_comment:"",transfer_speed_rating:0,liquidity_rating:0,usability_rating:0,support_rating:0,arbitrage_quality:-2},i.submitReview=function(){var e=!1;i.answers.transfer_speed_rating<1&&i.answers.liquidity_rating<1&&(e||(angular.element(-1==i.answers.provider_id.indexOf("p2p")?document.querySelector("#transfer-speed-rating-div"):document.querySelector("#liquidity-rating-div"))[0].scrollIntoView(),e=!0),i.transfer_speed_rating_is_invalid=!0),i.answers.usability_rating<1&&(e||(angular.element(document.querySelector("#usability-rating-div"))[0].scrollIntoView(),e=!0),i.usability_rating_is_invalid=!0),i.answers.support_rating<1&&(e||(angular.element(document.querySelector("#support-rating-div"))[0].scrollIntoView(),e=!0),i.support_rating_is_invalid=!0),-2==i.answers.arbitrage_quality&&-1==i.answers.provider_id.indexOf("p2p")&&(e||(angular.element(document.querySelector("#arbitrage-quality-div"))[0].scrollIntoView(),e=!0),i.arbitrage_quality_is_invalid=!0),(i.answers.review_comment.length<20||1500<i.answers.review_comment.length)&&(e||(angular.element(document.querySelector("#review-comment-area-div"))[0].scrollIntoView(),e=!0),i.review_comment_area_is_invalid=!0,i.review_comment_area_was_invalid=!0),i.review_comment_area_is_invalid||i.transfer_speed_rating_is_invalid||i.usability_rating_is_invalid||i.support_rating_is_invalid||i.arbitrage_quality_is_invalid?n(function(){i.review_comment_area_is_invalid=!1,i.transfer_speed_rating_is_invalid=!1,i.usability_rating_is_invalid=!1,i.support_rating_is_invalid=!1,i.arbitrage_quality_is_invalid=!1},1e3):i.submitting||(i.submitting=!0,s.execute({action:"submit_review"}).then(function(e){i.answers.captcha_response=e;e=t.BARNEY_ENDPOINT+"/"+t.COUNTRY+"/reviews/";"br"!=t.COUNTRY&&(e=t.BARNEY_ENDPOINT+"/reviews/"),r.put(e,i.answers),i.step1=!1,o(!0),i.step2=!0,i.submitting=!1}))},i.onRatingChange=function(e,t){i.answers[e]=t},i.getSelectedProvider=function(e){return angular.element(document.querySelectorAll('[value="'+e+'"]')).text().trim()},i.getSeeProviderReviewsUrl=function(e){return"/"+t.COUNTRY+"/opiniones/"+e+"/"},i.cancelModal=function(){e.cancel()}}]);