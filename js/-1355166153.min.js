angular.module("app",["ngSanitize","ngRoute","ngMaterial","ngMessages","ngMdIcons","ngclipboard","angular.snackbar","star-rating","afklStickyElement","angularPagination","ngLocationUpdate","fayzaan.gRecaptcha.v3"]).config(["$provide","$compileProvider","$mdThemingProvider","$sceDelegateProvider","$locationProvider",function(e,t,n,i,o){t.debugInfoEnabled(!1),n.disableTheming(!0),e.decorator("$exceptionHandler",["$delegate",function(n){return function(e,t){n(e,t),reportError(JSON.stringify({exception:"object"==typeof e?e.stack:""+e,cause:""+t}))}}]),i.resourceUrlWhitelist(["https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@**","**/partials/*"]),o.html5Mode(!0)}]);var e=angular.module("app");e.controller("ReviewsController",["$scope","$window","$location","$http","$timeout","$mdDialog","Pagination","gRecaptcha","commonFunctionsService",function(i,o,r,a,e,t,n,s,c){i.tooltipCopySuccessful=c.tooltipCopySuccessful,i.track=c.track,i.trackSystem=c.trackSystem,i.showCountriesMenu=c.showCountriesMenu,i.redirectTo=function(e){o.open(e,"_blank")},i.hideNews=function(e){return!!JSON.parse(o.localStorage.getItem(e+"_gift_news_closed"))||!1},i.closeNews=function(e,t){o.localStorage.setItem(e+"_gift_news_closed",!0)},s.initialize({key:"6Le6vr8ZAAAAAH6G2kvLs-VDT1cKIa_UGepnpMBI"});function l(e){u=e}var u=!(i.showDialogButtonEnabled=!0);i.showReviewSubmitDialog=function(e){i.showDialogButtonEnabled&&(i.showDialogButtonEnabled=!1,t.show({controller:"ReviewSubmitDialogController",templateUrl:"/"+o.COUNTRY+"/partials/review-submit-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,locals:{extraParameters:{providerSelected:i.providerSelected,context:"review-page"},changeSubmittedState:l,gRecaptchaV3:s},onComplete:function(){i.showDialogButtonEnabled=!0},onRemoving:function(e,t){u&&i.fetchReviewsWhenChangeOrderByOption("br"==o.COUNTRY?"mais-recentes":"mas-recientes",!0)}}))},i.fetchReviewsWhenChangeOrderByOption=function(e,t){i.orderByOption.option=e,i.pagination=n.create({itemsPerPage:5,itemsCount:i.reviewsCount,maxNumbers:5,currentPage:1}),i.changeReviewsPage(1,void 0,t)},i.fetchReviews=function(e){e=e||1,a.get(o.BARNEY_ENDPOINT+"/reviews/"+i.providerSelected+"/"+i.orderByOption.option+"/"+e).then(function(e){i.reviews=e.data},function(){})},e(function(){i.pagination=n.create({itemsPerPage:5,itemsCount:i.reviewsCount,maxNumbers:5,currentPage:i.page}),i.fetchReviews(i.page)},0),i.getReviews=function(){return i.reviews},i.getPageUrl=function(e){return"/"+o.COUNTRY+"/opiniones/"+i.providerSelected+"/"+i.orderByOption.option+"/"+e},i.changeReviewsPage=function(e,t,n){t&&t.preventDefault(),r.path()==i.getPageUrl(e)&&!n||(r.update_path(i.getPageUrl(e),!1),i.fetchReviews(e))},i.vote=function(t,n){("upvote"==n&&!t.already_upvoted||"downvote"==n&&!t.already_downvoted)&&("upvote"==n?(t.already_upvoted=!0,t.upvoted+=1):"downvote"==n&&(t.already_downvoted=!0,t.downvoted+=1),s.execute({action:"vote_review"}).then(function(e){a.patch(o.BARNEY_ENDPOINT+"/review/",{id:t.pk,operation_type:n,captcha_response:e})}))}}]),(e=angular.module("app")).controller("ReviewSubmitDialogController",["$scope","$window","$location","$timeout","$http","$mdDialog","extraParameters","changeSubmittedState","gRecaptchaV3",function(n,t,e,i,o,r,a,s,c){n.step1=!0,n.step2=!1,n.context=a.context,n.providerSelected=a.providerSelected,n.answers={provider_id:a.providerSelected,review_comment:"",transfer_speed_rating:0,usability_rating:0,support_rating:0},n.submitReview=function(){var e=!1;n.answers.transfer_speed_rating<1&&(e||(angular.element(document.querySelector("#transfer-speed-rating-div"))[0].scrollIntoView(),e=!0),n.transfer_speed_rating_is_invalid=!0),n.answers.usability_rating<1&&(e||(angular.element(document.querySelector("#usability-rating-div"))[0].scrollIntoView(),e=!0),n.usability_rating_is_invalid=!0),n.answers.support_rating<1&&(e||(angular.element(document.querySelector("#support-rating-div"))[0].scrollIntoView(),e=!0),n.support_rating_is_invalid=!0),(n.answers.review_comment.length<20||1500<n.answers.review_comment.length)&&(e||(angular.element(document.querySelector("#review-comment-area-div"))[0].scrollIntoView(),e=!0),n.review_comment_area_is_invalid=!0,n.review_comment_area_was_invalid=!0),n.review_comment_area_is_invalid||n.transfer_speed_rating_is_invalid||n.usability_rating_is_invalid||n.support_rating_is_invalid?i(function(){n.review_comment_area_is_invalid=!1,n.transfer_speed_rating_is_invalid=!1,n.usability_rating_is_invalid=!1,n.support_rating_is_invalid=!1},1e3):c.execute({action:"submit_review"}).then(function(e){n.answers.captcha_response=e,o.put(t.BARNEY_ENDPOINT+"/"+t.COUNTRY+"/reviews/",n.answers),n.step1=!1,s(!0),n.step2=!0})},n.onRatingChange=function(e,t){n.answers[e]=t},n.getSelectedProvider=function(e){return angular.element(document.querySelectorAll('[value="'+e+'"]')).text().trim()},n.getSeeProviderReviewsUrl=function(e){return"/"+t.COUNTRY+"/opiniones/"+e+"/"},n.cancelModal=function(){r.cancel()}}]);