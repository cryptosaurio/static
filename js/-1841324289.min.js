angular.module("app",["ngSanitize","ngMaterial","ngMessages","ngMdIcons","ngclipboard","angular.snackbar","tooltips","angular-carousel"]).config(["$provide","$compileProvider","$mdThemingProvider","$sceDelegateProvider",function(e,t,a,r){t.debugInfoEnabled(!1),a.disableTheming(!0),e.decorator("$locale",["$delegate",function(e){return e.NUMBER_FORMATS.DECIMAL_SEP=",",e.NUMBER_FORMATS.GROUP_SEP=".",e}]),e.decorator("$exceptionHandler",["$delegate",function(a){return function(e,t){a(e,t),reportError(JSON.stringify({exception:"object"==typeof e?e.stack:""+e,cause:""+t}))}}]),r.resourceUrlWhitelist(["https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@**","**/partials/*","**/static/**"])}]);var e=angular.module("app");e.service("providersService",function(){var t=new Set;this.get=function(){return Array.from(t).sort()},this.add=function(e){t.add(e)},this.delete=function(e){t.delete(e)},this.clear=function(){t.clear()}}),(e=angular.module("app")).controller("MainController",["$scope","$window","$q","$http","$interval","$timeout","$mdDialog","$animate","$mdPanel","providersService","commonFunctionsService",function(_,y,e,t,o,C,i,a,n,l,r){_.showCountriesMenu=r.showCountriesMenu,_.tooltipCopySuccessful=r.tooltipCopySuccessful,_.track=r.track,_.trackSystem=r.trackSystem;var c={ar:["ARS","USD"],mx:["MXN","USD"],cl:["CLP","USD"],br:["BRL","USD"],co:["COP","USD"]},s={ar:{ARS:new Set,USD:new Set},mx:{MXN:new Set,USD:new Set},cl:{CLP:new Set,USD:new Set},br:{BRL:new Set,USD:new Set},co:{COP:new Set,USD:new Set}},d={ar:{ARS:new Set,USD:new Set},mx:{MXN:new Set,USD:new Set},cl:{CLP:new Set,USD:new Set},br:{BRL:new Set,USD:new Set},co:{COP:new Set,USD:new Set}};_.minimumRollInversionPerCountry={ar:1e3,mx:150,cl:10500,br:50,co:4e4},_.maxDecimalsPerCoin={BTC:7,ETH:7,DAI:2,USDC:2,USDT:2},a.enabled(angular.element(document.getElementById("roll-calculator-dialog")),!1),_.redirectTo=function(e){y.location.href=e},_.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},_.carouselDataByCoin={btc:{index:0},eth:{index:0},dai:{index:0},usdc:{index:0},usdt:{index:0}},_.getObjectKeys=function(e){return Object.keys(e)},_.prevCarouselPage=function(e){--e.index},_.nextCarouselPage=function(e){e.index+=1};a=c[y.COUNTRY];-1<a.indexOf(y.localStorage.getItem("currency_selected"))&&(y.localStorage.setItem(y.COUNTRY+"_currency_selected",y.localStorage.getItem("currency_selected")),y.localStorage.removeItem("currency_selected")),_.currencySelected=-1<a.indexOf(y.localStorage.getItem(y.COUNTRY+"_currency_selected"))?y.localStorage.getItem(y.COUNTRY+"_currency_selected"):y.localStorage.removeItem(y.COUNTRY+"_currency_selected")||a[0];var u=[S];_.visibleFiltersDialog=!1;var b={},f={},p=!1,v=new Set,O=new Map,m={open:!1,coin:null};_.IS_MOBILE=window.IS_MOBILE;try{JSON.parse(y.localStorage.getItem("custom_alerts_config"))&&(y.localStorage.setItem(y.COUNTRY+"_custom_alerts_config",JSON.stringify(JSON.parse(y.localStorage.getItem("custom_alerts_config")))),y.localStorage.removeItem("custom_alerts_config"))}catch(e){y.localStorage.setItem(y.COUNTRY+"_custom_alerts_config",JSON.stringify({})),y.localStorage.removeItem("custom_alerts_config")}JSON.parse(y.localStorage.getItem("custom_alerts_enabled"))&&(y.localStorage.setItem(y.COUNTRY+"_custom_alerts_enabled",JSON.stringify(JSON.parse(y.localStorage.getItem("custom_alerts_enabled")))),y.localStorage.removeItem("custom_alerts_enabled"));try{_.customAlertsConfig=JSON.parse(y.localStorage.getItem(y.COUNTRY+"_custom_alerts_config"))||{}}catch(e){y.localStorage.setItem(y.COUNTRY+"_custom_alerts_config",JSON.stringify({})),_.customAlertsConfig={}}for(D in _.customAlertsEnabled=!!JSON.parse(y.localStorage.getItem(y.COUNTRY+"_custom_alerts_enabled"))&&!angular.equals(_.customAlertsConfig,{})||!1,y.localStorage.setItem(y.COUNTRY+"_custom_alerts_enabled",_.customAlertsEnabled),_.getCustomAlertText=function(){if(_.getAlertsEnabled()){var e,t=[];for(e in _.customAlertsConfig.coins)_.customAlertsConfig.coins[e].selected&&t.push(_.customAlertsConfig.coins[e].code);var a="";1<t.length?(a=t.slice(0,-1).join(", "),a+=" "+y.i18n.and+" "+t.slice(-1)[0]):a=t[0];var r=y.i18n["modulo-arbitrajes.alertas.alertas-configuradas.generic"];return _.customAlertsEnabled&&(r=y.i18n["modulo-arbitrajes.alertas.alertas-configuradas.dynamic"].replace("$COINS",a).replace("$PROFIT",_.customAlertsConfig.profit.replace(".",","))),r}return""},JSON.parse(y.localStorage.getItem("generic_alerts_enabled"))&&(y.localStorage.setItem(y.COUNTRY+"_generic_alerts_enabled",JSON.parse(y.localStorage.getItem("generic_alerts_enabled"))),y.localStorage.removeItem("generic_alerts_enabled")),_.alertsEnabled=!!JSON.parse(y.localStorage.getItem(y.COUNTRY+"_generic_alerts_enabled"))||_.customAlertsEnabled||!1,_.getAlertsEnabled=function(){return _.alertsEnabled},_.alertsPermissionGrantedInThePast="Notification"in window&&"granted"===Notification.permission,_.rollsLoadingStatus="indeterminate",c[y.COUNTRY])try{JSON.parse(y.localStorage.getItem("blocked_providers_"+c[y.COUNTRY][D].toLowerCase()))&&(y.localStorage.setItem(y.COUNTRY+"_blocked_providers_"+c[y.COUNTRY][D],JSON.stringify(JSON.parse(y.localStorage.getItem("blocked_providers_"+c[y.COUNTRY][D].toLowerCase())))),y.localStorage.removeItem("blocked_providers_"+c[y.COUNTRY][D].toLowerCase())),s[y.COUNTRY][c[y.COUNTRY][D]]=new Set(JSON.parse(y.localStorage.getItem(y.COUNTRY+"_blocked_providers_"+c[y.COUNTRY][D])))}catch(e){y.localStorage.setItem(y.COUNTRY+"_blocked_providers_"+c[y.COUNTRY][D],JSON.stringify([]))}for(D in _.appliedFiltersText=function(){return 0<s[y.COUNTRY][_.currencySelected].size?" ("+s[y.COUNTRY][_.currencySelected].size+")":""},c[y.COUNTRY])try{d[y.COUNTRY][c[y.COUNTRY][D]]=new Set(JSON.parse(y.localStorage.getItem(y.COUNTRY+"_blocked_providers_"+c[y.COUNTRY][D])))}catch(e){y.localStorage.setItem(y.COUNTRY+"_blocked_providers_"+c[y.COUNTRY][D],JSON.stringify([]))}function h(){return Array.from(s[y.COUNTRY][_.currencySelected]).sort()}function g(r,n){return _.coinsData[r]=_.coinsData[r]||{},_.coinsData[r][n]=_.coinsData[r][n]||{},_.coinsData[r][n].loadingStatus="indeterminate",t.get(y.PRICES_ENDPOINT+"/prices/"+_.currencySelected+"/"+r+"/"+n+(0<h().length?"?not="+h().join():""),{headers:{"If-None-Match":f[r+n+_.currencySelected+h().join("")]}}).then(function(e){var t,a=[];for(t in f[r+n+_.currencySelected+h().join("")]=e.headers("Etag"),e.data)e.data[t].fields[_.currencySelected]?(e.data[t].fields.price=e.data[t].fields[_.currencySelected],e.data[t].fields.price.currencyMask=-1<["ARS","MXN","CLP","COP"].indexOf(_.currencySelected)?"$":"BRL"==_.currencySelected?"R$":"US$"):e.data[t].fields.prices&&e.data[t].fields.prices[_.currencySelected]&&e.data[t].fields.prices[_.currencySelected][n]&&0<e.data[t].fields.prices[_.currencySelected][n].length&&(e.data[t].fields.price=e.data[t].fields.prices[_.currencySelected][n][0],e.data[t].fields.price.currencyMask=-1<["ARS","MXN","CLP","COP"].indexOf(_.currencySelected)?"$":"BRL"==_.currencySelected?"R$":"US$",e.data[t].fields.currencyMask=-1<["ARS","MXN","CLP","COP"].indexOf(_.currencySelected)?"$":"BRL"==_.currencySelected?"R$":"US$"),(e.data[t].fields[_.currencySelected]||e.data[t].fields.prices&&e.data[t].fields.prices[_.currencySelected]&&e.data[t].fields.prices[_.currencySelected][n])&&(a.push(e.data[t]),l.add(e.data[t].fields.name),s[y.COUNTRY][_.currencySelected].forEach(l.add,l));_.coinsData[r][n]=a,m.open&&_.showP2PModal(m.provider,m.coin,m.operationType,null,!0)},function(e){304!==e.status?_.coinsData[r][n].error=!0:_.coinsData[r][n].error=!1}).finally(function(){_.coinsData[r][n].loadingStatus="determinate"})}_.notExistsInBlockedProvidersList=function(e){return!d[y.COUNTRY][_.currencySelected].has(e)},_.addOrRemoveFromBlockedProviderList=function(e){_.notExistsInBlockedProvidersList(e)?d[y.COUNTRY][_.currencySelected].add(e):d[y.COUNTRY][_.currencySelected].delete(e)},_.getProviders=function(){return _.visibleFiltersDialog?Array.from(new Set(l.get().concat(Array.from(s[y.COUNTRY][_.currencySelected])))).sort():[]},_.anyProviderCheckedInFiltersDialog=function(){return d[y.COUNTRY][_.currencySelected].size==_.getProviders().length},_.doFilterProviders=function(){if(!Array.from(d[y.COUNTRY][_.currencySelected]).every(s[y.COUNTRY][_.currencySelected].has.bind(s[y.COUNTRY][_.currencySelected]))||0<s[y.COUNTRY][_.currencySelected].size&&0==d[y.COUNTRY][_.currencySelected].size||s[y.COUNTRY][_.currencySelected].size>d[y.COUNTRY][_.currencySelected].size){for(var e in s[y.COUNTRY][_.currencySelected]=new Set(d[y.COUNTRY][_.currencySelected]),c[y.COUNTRY])y.localStorage.setItem(y.COUNTRY+"_blocked_providers_"+c[y.COUNTRY][e],JSON.stringify(Array.from(s[y.COUNTRY][c[y.COUNTRY][e]])));_.updatePrices(void 0,!0)}i.hide()},_.changePriceDisabled=!1,_.whenChangeCurrency=function(e){u.push(e)},_.updatePrices=function(e,t){for(var a in v.clear(),O.clear(),t?y.dataLayer.push({event:"user_action",event_category:"providers_filtered",event_label:h().join()||"Unfiltered"}):(e&&(_.currencySelected=e),y.dataLayer.push({event:"user_action",event_category:"currency_change",event_label:_.currencySelected}),_.changePriceDisabled=!0,s[y.COUNTRY][_.currencySelected]=new Set(JSON.parse(y.localStorage.getItem(y.COUNTRY+"_blocked_providers_"+_.currencySelected))),d[y.COUNTRY][_.currencySelected]=new Set(JSON.parse(y.localStorage.getItem(y.COUNTRY+"_blocked_providers_"+_.currencySelected))),l.clear()),b={},f={},u)u[a]();t?(p=!0,C(function(){p=!1},1e3)):C(function(){_.changePriceDisabled=!1},2500),y.localStorage.setItem(y.COUNTRY+"_currency_selected",_.currencySelected)},_.btc_title="<i class='crypto-icon btc'></i> <h2>BITCOIN</h2>",_.eth_title="<i class='crypto-icon eth'></i> <h2>ETHEREUM</h2>",_.dai_title="<i class='crypto-icon dai'></i> <h2>DAI</h2>",_.usdc_title="<i class='crypto-icon usdc'></i> <h2>USDC</h2>",_.usdt_title="<i class='crypto-icon usdt'></i> <h2>USDT</h2>",_.coinsData={},_.showP2PModal=function(e,t,a,r,n){for(var o={name:"",ask:{},bid:{}},l=0;l<_.coinsData[t][a].length;l++)if(_.coinsData[t][a][l].fields.id==e){o.name=_.coinsData[t][a][l].fields.name,o[a]=_.coinsData[t][a][l],_.p2pLimitAvailable=_.coinsData[t][a][l].fields.prices[_.currencySelected]&&_.coinsData[t][a][l].fields.prices[_.currencySelected][a]&&0<_.coinsData[t][a][l].fields.prices[_.currencySelected][a].length&&null!=_.coinsData[t][a][l].fields.prices[_.currencySelected][a][0].limit;break}_.p2pOperationType=a,_.p2pModalData=o,_.p2pModalData[a]&&_.p2pModalData[a].fields.prices[_.currencySelected][a]&&0!=_.p2pModalData[a].fields.prices[_.currencySelected][a].length||i.cancel(),n||(_.p2pCoinSelected=t.toUpperCase(),_.p2pModalTitle=_[t+"_title"],_.p2pModalProviderId=e,m.open=!0,m.coin=t,m.operationType=a,m.provider=e,y.dataLayer.push({event:"user_action",event_category:"p2p_modal_binance_open",event_label:"binance_"+t+"_"+a}),i.show({contentElement:"#p2p-dialog",parent:angular.element(document.body),targetEvent:r,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,onRemoving:function(){m.open=!1}}))},_.specificRollData={};var R={body:y.i18n["modulo-arbitrajes.alertas.alerta.new.text"],icon:"/static/img/logo-web.png?v1"},N=new Set;for(D in y.AVAILABLE_COINS)N.add(y.AVAILABLE_COINS[D].toUpperCase());function S(){_.rollsLoadingStatus="indeterminate",t.get(y.PRICES_ENDPOINT+"/rolls/"+_.currencySelected+(0<h().length?"?not="+h().join():""),{headers:{"If-None-Match":b[_.currencySelected+h().join("")]}}).then(function(e){var t=[];b[_.currencySelected+h().join("")]=e.headers("Etag");var a="";for(c in Array.from(N))A(!1,Array.from(N)[c].toLowerCase());var r="",n=[];for(c in e.data){if(a!=e.data[c].k&&(a=e.data[c].k),e.data[c].buy.fields[_.currencySelected]&&e.data[c].sell.fields[_.currencySelected]){e.data[c].buy.fields.price=e.data[c].buy.fields[_.currencySelected],e.data[c].sell.fields.price=e.data[c].sell.fields[_.currencySelected],e.data[c].buy.fields.currencyMask=-1<["ARS","MXN","CLP","COP"].indexOf(_.currencySelected)?"$":"BRL"==_.currencySelected?"R$":"US$",e.data[c].sell.fields.currencyMask=-1<["ARS","MXN","CLP","COP"].indexOf(_.currencySelected)?"$":"BRL"==_.currencySelected?"R$":"US$";for(var o=!1,l=0;l<t.length&&!o;l++)t[l].k==a&&(o=!0);n[a]=n[a]||[],n[a].push(e.data[c]),o||t.push(e.data[c]),""!=r&&r!=a&&A(!0,r,n[r]),e.data.length-1==c&&A(!0,a,n[a])}else""!=r&&r!=a&&A(!1,r);r=a}if(_.rollsLoadingStatus="determinate",!window.IS_MOBILE){var i,c,s,d,u,f=new Set,p=new Set,m=new Set;for(c in N.forEach(m.add,m),t)if(m.delete(t[c].k.toUpperCase()),!_.customAlertsEnabled||_.customAlertsEnabled&&0<_.customAlertsConfig.coins.filter(function(e){return e.code==t[c].k.toUpperCase()&&e.selected}).length&&parseFloat(t[c].difference.replace(",","."))>=_.customAlertsConfig.profit){if(v.has(t[c].k.toUpperCase())&&O.has(t[c].k.toUpperCase()+"|"+t[c].buy.fields.name.toUpperCase()+"|"+t[c].sell.fields.name.toUpperCase()))O.has(t[c].k.toUpperCase()+"|"+t[c].buy.fields.name.toUpperCase()+"|"+t[c].sell.fields.name.toUpperCase())&&.5<=parseFloat(t[c].difference.replace(",","."))-O.get(t[c].k.toUpperCase()+"|"+t[c].buy.fields.name.toUpperCase()+"|"+t[c].sell.fields.name.toUpperCase())&&p.add(t[c].k.toUpperCase());else{v.add(t[c].k.toUpperCase()),f.add(t[c].k.toUpperCase());var g,S=Array.from(O.keys());for(g in S)S[g].substring(0,3)==t[c].k.toUpperCase()&&O.delete(S[g])}O.set(t[c].k.toUpperCase()+"|"+t[c].buy.fields.name.toUpperCase()+"|"+t[c].sell.fields.name.toUpperCase(),parseFloat(t[c].difference.replace(",",".")))}m.forEach(v.delete,v),document.hidden&&!window.IS_MOBILE&&"Notification"in window&&"granted"===Notification.permission&&_.alertsEnabled&&(0<f.size||0<p.size)&&(f.forEach(v.add,v),p.forEach(v.add,v),0<f.size&&(i="",c=1,u=JSON.parse(JSON.stringify(R)),f.forEach(function(e){2==c&&f.size==c?i+=" "+y.i18n.and+" "+e:2==c?i+=", "+e:1==c&&(i+=e),c++}),s=0,2==f.size?(s=1,u.body=y.i18n["modulo-arbitrajes.alertas.alerta.text"]):2<f.size&&(s=2,u.body=y.i18n["modulo-arbitrajes.alertas.alerta.many.text"]),u.body=u.body.replace("$COIN",i),new Notification(["📣","🎉","🥳"][s]+" "+y.i18n["modulo-arbitrajes.alertas.alerta.title"],u).onclick=function(){window.focus(),y.dataLayer.push({event:"user_action",event_category:"notification",event_label:"click"})},d=[],O.forEach(function(e,t){d.push(t+"|"+e)}),y.dataLayer.push({event:"system_action",event_category:"notification_sended",event_label:d.toString(",")})),0<p.size&&((u=0)<f.size&&(u=1e4),C(function(){var t="",a=1,e=JSON.parse(JSON.stringify(R));p.forEach(function(e){2==a&&p.size==a?t+=" "+y.i18n.and+" "+e:2==a?t+=", "+e:1==a&&(t+=e),a++}),p.size<=2?e.body=y.i18n["modulo-arbitrajes.alertas.alerta.more-profit.text"]:2<p.size&&(e.body=y.i18n["modulo-arbitrajes.alertas.alerta.more-profit.many.text"]),e.body=e.body.replace("$COIN",t),new Notification(["💰","📈","🔥"][Math.floor(3*Math.random())]+" "+y.i18n["modulo-arbitrajes.alertas.alerta.more-profit.title"],e).onclick=function(){window.focus(),y.dataLayer.push({event:"user_action",event_category:"notification",event_label:"click"})}},u)))}},function(e){304!==e.status&&A(!1),_.rollsLoadingStatus="determinate"})}function A(e,t,a){if(t){for(var r in _.specificRollData[t]=_.specificRollData[t]||[],_.specificRollData[t])delete _.specificRollData[t][r].manuallySetted,_.specificRollData[t][r]=_.specificRollData[t][r]||{};if(a){for(var r in a)_.specificRollData[t][r]=_.specificRollData[t][r]||{},_.specificRollData[t][r].data=a[r],3.5<=parseFloat(_.specificRollData[t][r].data.difference.replace(",","."))&&_.specificRollData[t][r].data.buy.fields.score&&10<=_.specificRollData[t][r].data.buy.fields.score.count&&_.specificRollData[t][r].data.sell.fields.score&&10<=_.specificRollData[t][r].data.sell.fields.score.count&&3.5<=_.specificRollData[t][r].data.buy.fields.score.average_transfer_speed_rating&&3.5<=_.specificRollData[t][r].data.sell.fields.score.average_transfer_speed_rating?(_.specificRollData[t][r].score=3,_.trackSystem("unique_opportunity","show")):delete _.specificRollData[t][r].score;_.carouselDataByCoin[t].index>=_.specificRollData[t].length&&(_.carouselDataByCoin[t].index=0)}else delete _.specificRollData[t]}else if(!e){var n=Object.keys(_.specificRollData);for(r in n)delete _.specificRollData[n[r]]}}var U=!(_.showFiltersDialog=function(e){p||(_.visibleFiltersDialog=!0,i.show({contentElement:"#filters-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,onRemoving:function(){_.visibleFiltersDialog=!1}}))}),I=!1;_.showRollCalculatorDialog=function(e,t,a){I=U=!1,_.showCalculatorWarning=!1,y.dataLayer.push({event:"user_action",event_category:"roll_calculator",event_label:"open_"+t+"_"+_.currencySelected}),_.selectedCoinForRoll=t,_.rollCalculator={amount:("BTC"!=t.toUpperCase()&&"ETH"!=t.toUpperCase()?1e3*_.specificRollData[_.selectedCoinForRoll][a].data.buy.fields[_.currencySelected].ask:_.specificRollData[_.selectedCoinForRoll][a].data.buy.fields[_.currencySelected].ask).toString().replace(".",",")},_.calculatorRollData=Object.assign({},_.specificRollData[t][a]);var o=_.specificRollData[t][a].data.buy.fields.id+"-"+_.specificRollData[t][a].data.sell.fields.id,r=_.$watch("specificRollData[selectedCoinForRoll]",function(e,t){var a=!1,r=!1;if(e)for(var n in e)if(e[n].data.buy.fields.id+"-"+e[n].data.sell.fields.id==o){e=e[n],a=!0;break}if(e&&!a&&(e=void 0),t)for(var n in t)if(t[n].data.buy.fields.id+"-"+t[n].data.sell.fields.id==o){t=t[n],r=!0;break}t&&!r&&(t=void 0),e&&e.manuallySetted||e===t||(U||e&&(!e||e===t||e.data.buy.fields.name===t.data.buy.fields.name&&e.data.sell.fields.name===t.data.sell.fields.name)?U||I||e===t||e.data.buy.fields.name!==t.data.buy.fields.name||e.data.sell.fields.name!==t.data.sell.fields.name||e.data.buy.fields[_.currencySelected].ask===t.data.buy.fields[_.currencySelected].ask&&e.data.sell.fields[_.currencySelected].bid===t.data.sell.fields[_.currencySelected].bid||(I=!0,_.calculatorWarningText=y.i18n["modulo-arbitrajes.calculadora.roll-updated"],_.calculatorWarningCTAText=y.i18n["modulo-arbitrajes.calculadora.roll-updated.cta"],_.calculatorWarningCTAAvailable=!0,_.showCalculatorWarning=!0):(U=!0,_.calculatorWarningText=y.i18n["modulo-arbitrajes.calculadora.roll-unavailable"],_.calculatorWarningCTAAvailable=!1,_.showCalculatorWarning=!0))},!0);_.selectedRollIndexNumber=a,i.show({contentElement:"#roll-calculator-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,onRemoving:function(){r()}})},_.updateValuesInRollCalculator=function(){_.calculatorWarningCTAAvailable&&(_.specificRollData[_.selectedCoinForRoll][_.selectedRollIndexNumber].manuallySetted=!0,_.calculatorRollData=Object.assign({},_.specificRollData[_.selectedCoinForRoll][_.selectedRollIndexNumber]),_.showCalculatorWarning=!1,I=!1)},_.getMinimumRollInversion=function(e){if(!e||!e.buy.fields[_.currencySelected]||!e.sell.fields[_.currencySelected])return!1;if(e){var t=1e6/e.buy.fields[_.currencySelected].ask*e.sell.fields[_.currencySelected].bid-1e6;return 1e6*(_.minimumRollInversionPerCountry[y.COUNTRY]+e.gas_costs)/t}},_.showAlertsPermissionDialog=function(e,t){(_.alertsForcedFiltersStep=t)?_.customizeAlerts():(_.step1Alerts=!0,_.step2Alerts=!1,_.step3Alerts=!1),i.show({contentElement:"#alerts-permission-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0})};var T={body:y.i18n["modulo-arbitrajes.alertas.alerta.welcome.text"],icon:"/static/img/logo-web.png?v1"},w={body:y.i18n["modulo-arbitrajes.alertas.alerta.welcome.custom-alerts.text"],icon:"/static/img/logo-web.png?v1"};if(_.customAlertsEnabled?_.availableOptionsForAlerts=JSON.parse(y.localStorage.getItem(y.COUNTRY+"_custom_alerts_config"))||{}:_.availableOptionsForAlerts={coins:[],profit:void 0},_.availableOptionsForAlerts.coins||0==_.availableOptionsForAlerts.coins.length)for(var D in _.availableOptionsForAlerts={coins:[],profit:void 0},Array.from(N))_.availableOptionsForAlerts.coins.push({code:Array.from(N)[D],selected:!1});else for(var D in Array.from(N)){var E,L=!1;for(E in _.availableOptionsForAlerts.coins)_.availableOptionsForAlerts.coins[E].code==Array.from(N)[D]&&(L=!0);L||_.availableOptionsForAlerts.coins.push({code:Array.from(N)[D],selected:!1})}_.isCoinsIndeterminatedInAlertCustomization=function(){return 0<_.availableOptionsForAlerts.coins.filter(function(e){return e.selected}).length&&!_.allCoinsSelectedInAlertCustomization()},_.allCoinsSelectedInAlertCustomization=function(){return 0===_.availableOptionsForAlerts.coins.filter(function(e){return!e.selected}).length},_.anyCoinSelectedInCustomization=function(){return 0<_.availableOptionsForAlerts.coins.filter(function(e){return e.selected}).length},_.toggleAllCoinsInAlertCustomization=function(){_.allCoinsSelectedInAlertCustomization()?_.availableOptionsForAlerts.coins.forEach(function(e){e.selected=!1}):_.availableOptionsForAlerts.coins.filter(function(e){return!e.selected}).forEach(function(e){e.selected=!0})},_.customizeAlerts=function(){_.step1Alerts=!1,_.step2Alerts=!0,_.step3Alerts=!1},_.enableAlerts=function(){_.step1Alerts=!1,_.step2Alerts=!1,_.step3Alerts=!0,_.customAlertsConfig=_.availableOptionsForAlerts,y.localStorage.setItem(y.COUNTRY+"_custom_alerts_config",angular.toJson(_.customAlertsConfig)),y.dataLayer.push({event:"user_action",event_category:"notifications_configured",event_label:_.customAlertsConfig.coins.filter(function(e){return e.selected}).map(function(e){return e.code}).toString(",")+"|"+_.customAlertsConfig.profit}),"Notification"in window&&"granted"===Notification.permission?(_.cancelModal(),y.localStorage.getItem(y.COUNTRY+"_custom_alerts_enabled")?_.alertsForcedFiltersStep?r.sendSnackbarAlert(y.i18n["modulo-arbitrajes.alertas.alerta.saved"]):new Notification(y.i18n["modulo-arbitrajes.alertas.alerta.welcome.title"],T):new Notification(y.i18n["modulo-arbitrajes.alertas.alerta.custom-alerts.welcome"],w),_.alertsEnabled=!0,_.customAlertsEnabled=!0,y.localStorage.removeItem(y.COUNTRY+"_generic_alerts_enabled"),y.localStorage.setItem(y.COUNTRY+"_custom_alerts_enabled",!0),y.dataLayer.push({event:"notifications_change",event_category:"user_action",event_label:"re_enabled_with_customization"})):"Notification"in window&&"denied"!==Notification.permission&&Notification.requestPermission().then(function(e){"granted"===e?(_.cancelModal(),new Notification(y.i18n["modulo-arbitrajes.alertas.alerta.welcome.title"],T),_.alertsEnabled=!0,_.customAlertsEnabled=!0,y.localStorage.removeItem(y.COUNTRY+"_generic_alerts_enabled"),y.localStorage.setItem(y.COUNTRY+"_custom_alerts_enabled",!0),y.dataLayer.push({event:"user_action",event_category:"notifications_change",event_label:"enabled_with_customization"})):y.dataLayer.push({event:"user_action",event_category:"notifications_change",event_label:"rejected_with_customization"})})},_.disableAlerts=function(){_.cancelModal(),_.alertsEnabled=!1,_.customAlertsEnabled=!1,_.customAlertsConfig={},y.localStorage.setItem(y.COUNTRY+"_generic_alerts_enabled",!1),y.localStorage.setItem(y.COUNTRY+"_custom_alerts_enabled",!1),y.localStorage.removeItem(y.COUNTRY+"_custom_alerts_config"),r.sendSnackbarAlert(y.i18n["modulo-arbitrajes.alertas.disabled.text"]),y.dataLayer.push({event:"notifications_change",event_category:"user_action",event_label:"disabled"})},_.cancelModal=function(){i.cancel()};var k,Y=(k=".comparative-tables-menu-item",function(e,t,a){this._mdPanelRef=e,this.$timeout=t,this.$window=a,this.custom_class=k});Y.$inject=["mdPanelRef","$timeout","$window"],Y.prototype.$onInit=function(){this.$timeout(function(){var e=document.querySelector(this.custom_class+".selected");(e?angular.element(e):angular.element(document.querySelectorAll(this.custom_class)[0])).focus()})},Y.prototype.selectOption=function(e){this._mdPanelRef&&this._mdPanelRef.close().then(function(){y.location.href=e})},Y.prototype.indexOf=function(e,t){for(var a,r=0;a=e[r];r++)if(a===t)return r;return-1},Y.prototype.onMouseOver=function(e){angular.element(e.srcElement||e.target).focus()},Y.prototype.onKeydown=function(e,t){var a,r;switch(e.which){case 38:(r=document.querySelectorAll(this.custom_class))[(this.indexOf(r,document.activeElement)+r.length-1)%r.length].focus(),a=!0;break;case 40:(r=document.querySelectorAll(this.custom_class))[(this.indexOf(r,document.activeElement)+1)%r.length].focus(),a=!0;break;case 13:case 32:this.selectOption(t),a=!0;break;case 9:this._mdPanelRef&&this._mdPanelRef.close()}a&&(e.preventDefault(),e.stopImmediatePropagation())},_.showComparativeTablesMenu=function(e,t,a){var r=n.newPanelPosition().relativeTo(".comparative-tables-menu-button-"+t+"-"+a.fields.id).addPanelPosition(n.xPosition.ALIGN_START,n.yPosition.BELOW),t={options:[]};a.fields.prices||t.options.push({text:"Ficha técnica",url:y.SITE_URL+y.TECHNICAL_DATA_URL+"/"+("ripio-exchange"==a.fields.id?"ripio":a.fields.id)}),t.options.push({text:y.i18n["provider-reviews.title"],url:y.SITE_URL+y.i18n["ranking.url"]+"/"+("ripio-exchange"==a.fields.id?"ripio":a.fields.id)+"/"});e={attachTo:angular.element(document.body),controller:Y,controllerAs:"ctrl",template:'<div class="comparative-tables-menu"      role="listbox">  <div class="comparative-tables-menu-item"        tabindex="-1"        role="option"        ng-repeat="option in ctrl.options"        ng-click="ctrl.selectOption(option.url)"       ng-mouseover="ctrl.onMouseOver($event)"       ng-keydown="ctrl.onKeydown($event, option.url)">    {{ option.text }}   </div></div>',position:r,locals:t,openFrom:e,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!1,zIndex:10};n.open(e)},!window.IS_MOBILE&&"Notification"in window&&"granted"===Notification.permission&&_.alertsEnabled||(_.alertsEnabled=!1,y.localStorage.setItem(y.COUNTRY+"_generic_alerts_enabled",!1));var P=["ask","bid"],x=[];for(D in S(),y.AVAILABLE_COINS)for(var M in P)g(y.AVAILABLE_COINS[D],P[M]),x[y.AVAILABLE_COINS[D]+P[M]]={interval:o(function(e,t){g(e,t)},6e4,0,!0,y.AVAILABLE_COINS[D],P[M]),handled:!0},function(e,t){u.push(function(){g(e,t)})}(y.AVAILABLE_COINS[D],P[M]);var $,F,B=o(S,6e4),j=!0;document.addEventListener("visibilitychange",function(){for(var e in _.getAlertsEnabled()||(j=!0,o.cancel(B),C.cancel($),document.hidden?j=!1:(B=o(S,6e4),$=C(S,500))),y.AVAILABLE_COINS){var t,a=y.AVAILABLE_COINS[e];for(t in P){var r=P[t];x[a+r]=x[a+r]||{};var n=x[a+r];n.handled=!0,o.cancel(n.interval),C.cancel(n.future_execution),document.hidden?n.handled=!1:(n.interval=o(function(e,t){g(e,t)},6e4,0,!0,a,r),n.future_execution=C(function(e,t){g(e,t)},500,!0,a,r))}}}),window.addEventListener("focus",function(){for(var e in _.getAlertsEnabled()||(C.cancel(F),F=C(function(){j||(o.cancel(B),C.cancel($),B=o(S,6e4),$=C(S,1),j=!0)},499)),y.AVAILABLE_COINS){var t,a=y.AVAILABLE_COINS[e];for(t in P){var r=P[t];x[a+r]=x[a+r]||{};var n=x[a+r];C.cancel(n.focusTimeout),n.focusTimeout=C(function(){n.handled||(o.cancel(n.interval),C.cancel(n.future_execution),n.interval=o(function(e,t){g(e,t)},6e4,0,!0,a,r),n.future_execution=C(function(e,t){g(e,t)},1,!0,a,r))},499)}}})}]).filter("makePositive",function(){return function(e){return Math.abs(e)}}).directive("sanitizeCalculatorInput",function(){return{require:"ngModel",link:function(e,t,a,r){e.$watch(a.ngModel,function(e){null!=e&&(r.$setViewValue(String(e).replace(/,/g,".").replace(/\$/g,"").substring(0,9)),t.val(String(e).replace(/,/g,".").replace(/\$/g,"").substring(0,9)))})}}}).directive("input",function(){return{restrict:"E",require:"ngModel",link:function(e,t,a,r){"number"===t[0].type&&(r.$parsers.push(function(e){return Number(e)}),r.$formatters.push(function(e){return parseFloat(e,10)}))}}});