angular.module("app",["ngSanitize","ngMaterial","ngMessages","ngMdIcons","ngclipboard","angular.snackbar","tooltips","angular-carousel"]).config(["$provide","$compileProvider","$mdThemingProvider","$sceDelegateProvider",function(e,t,a,n){t.debugInfoEnabled(!1),a.disableTheming(!0),e.decorator("$locale",["$delegate",function(e){return e.NUMBER_FORMATS.DECIMAL_SEP=",",e.NUMBER_FORMATS.GROUP_SEP=".",e}]),e.decorator("$exceptionHandler",["$delegate",function(a){return function(e,t){a(e,t),reportError(JSON.stringify({exception:"object"==typeof e?e.stack:""+e,cause:""+t}))}}]),n.resourceUrlWhitelist(["https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@**","**/partials/*","**/static/**"])}]);var e=angular.module("app");e.service("providersService",function(){var t=new Set;this.get=function(){return Array.from(t).sort()},this.add=function(e){t.add(e)},this.delete=function(e){t.delete(e)},this.clear=function(){t.clear()}}),(e=angular.module("app")).controller("MainController",["$scope","$window","$q","$http","$interval","$timeout","$mdDialog","$animate","$mdPanel","providersService","commonFunctionsService",function(y,s,e,t,d,C,o,a,n,r,i){y.tooltipCopySuccessful=i.tooltipCopySuccessful,y.track=i.track,y.trackSystem=i.trackSystem,a.enabled(angular.element(document.getElementById("roll-calculator-dialog")),!1),y.redirectTo=function(e){s.location.href=e},y.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},y.carouselDataByCoin={btc:{index:0},eth:{index:0},dai:{index:0},usdc:{index:0},usdt:{index:0}},y.getObjectKeys=function(e){return Object.keys(e)},y.prevCarouselPage=function(e){--e.index},y.nextCarouselPage=function(e){e.index+=1};var l={ar:["ARS","USD"],mx:["MXN","USD"]},a=l[s.COUNTRY];-1<a.indexOf(s.localStorage.getItem("currency_selected"))&&(s.localStorage.setItem(s.COUNTRY+"_currency_selected",s.localStorage.getItem("currency_selected")),s.localStorage.removeItem("currency_selected")),y.currencySelected=-1<a.indexOf(s.localStorage.getItem(s.COUNTRY+"_currency_selected"))?s.localStorage.getItem(s.COUNTRY+"_currency_selected"):s.localStorage.removeItem(s.COUNTRY+"_currency_selected")||a[0];var u=[S];y.visibleFiltersDialog=!1;var v={},c={},f=!1,_=new Set,b=new Map;y.IS_MOBILE=window.IS_MOBILE,JSON.parse(s.localStorage.getItem("custom_alerts_config"))&&(s.localStorage.setItem(s.COUNTRY+"_custom_alerts_config",JSON.stringify(JSON.parse(s.localStorage.getItem("custom_alerts_config")))),s.localStorage.removeItem("custom_alerts_config")),JSON.parse(s.localStorage.getItem("custom_alerts_enabled"))&&(s.localStorage.setItem(s.COUNTRY+"_custom_alerts_enabled",JSON.stringify(JSON.parse(s.localStorage.getItem("custom_alerts_enabled")))),s.localStorage.removeItem("custom_alerts_enabled"));try{y.customAlertsConfig=JSON.parse(s.localStorage.getItem(s.COUNTRY+"_custom_alerts_config"))||{}}catch{s.localStorage.setItem(s.COUNTRY+"_custom_alerts_config",{}),y.customAlertsConfig={}}y.customAlertsEnabled=!!JSON.parse(s.localStorage.getItem(s.COUNTRY+"_custom_alerts_enabled"))&&!angular.equals(y.customAlertsConfig,{})||!1,y.getCustomAlertText=function(){if(y.getAlertsEnabled()){var e,t=[];for(e in y.customAlertsConfig.coins)y.customAlertsConfig.coins[e].selected&&t.push(y.customAlertsConfig.coins[e].code);var a="";1<t.length?(a=t.slice(0,-1).join(", "),a+=" y "+t.slice(-1)[0]):a=t[0];var n="Tenés alertas configuradas.";return y.customAlertsEnabled&&(n="Tenés una alerta para "+a+" desde "+y.customAlertsConfig.profit.replace(".",",")+"% de ganancia."),n}return""},JSON.parse(s.localStorage.getItem("generic_alerts_enabled"))&&(s.localStorage.setItem(s.COUNTRY+"_generic_alerts_enabled",JSON.parse(s.localStorage.getItem("generic_alerts_enabled"))),s.localStorage.removeItem("generic_alerts_enabled")),y.alertsEnabled=!!JSON.parse(s.localStorage.getItem("generic_alerts_enabled"))||y.customAlertsEnabled||!1,y.getAlertsEnabled=function(){return y.alertsEnabled},y.alertsPermissionGrantedInThePast="Notification"in window&&"granted"===Notification.permission,y.rollsLoadingStatus="indeterminate",y.maxDecimalsPerCoin={BTC:7,ETH:7,DAI:2,USDC:2,USDT:2};var g={ar:{ARS:new Set,USD:new Set},mx:{MXN:new Set,USD:new Set}};for(w in l[s.COUNTRY])try{JSON.parse(s.localStorage.getItem("blocked_providers_"+l[s.COUNTRY][w].toLowerCase()))&&(s.localStorage.setItem(s.COUNTRY+"_blocked_providers_"+l[s.COUNTRY][w],JSON.stringify(JSON.parse(s.localStorage.getItem("blocked_providers_"+l[s.COUNTRY][w].toLowerCase())))),s.localStorage.removeItem("blocked_providers_"+l[s.COUNTRY][w].toLowerCase())),g[s.COUNTRY][l[s.COUNTRY][w]]=new Set(JSON.parse(s.localStorage.getItem(s.COUNTRY+"_blocked_providers_"+l[s.COUNTRY][w])))}catch(e){s.localStorage.setItem(s.COUNTRY+"_blocked_providers_"+l[s.COUNTRY][w],JSON.stringify([]))}y.appliedFiltersText=function(){return 0<g[s.COUNTRY][y.currencySelected].size?" ("+g[s.COUNTRY][y.currencySelected].size+")":""};var p={ar:{ARS:new Set,USD:new Set},mx:{MXN:new Set,USD:new Set}};for(w in l[s.COUNTRY])try{p[s.COUNTRY][l[s.COUNTRY][w]]=new Set(JSON.parse(s.localStorage.getItem(s.COUNTRY+"_blocked_providers_"+l[s.COUNTRY][w])))}catch(e){s.localStorage.setItem(s.COUNTRY+"_blocked_providers_"+l[s.COUNTRY][w],JSON.stringify([]))}function O(){return Array.from(g[s.COUNTRY][y.currencySelected]).sort()}function m(n,o){return y.coinsData[n]=y.coinsData[n]||{},y.coinsData[n][o]=y.coinsData[n][o]||{},y.coinsData[n][o].loadingStatus="indeterminate",t.get(s.PRICES_ENDPOINT+"/"+s.COUNTRY+"/prices/"+y.currencySelected+"/"+n+"/"+o+(0<O().length?"?not="+O().join():""),{headers:{"If-None-Match":c[n+o+y.currencySelected+O().join("")]}}).then(function(e){var t,a=[];for(t in c[n+o+y.currencySelected+O().join("")]=e.headers("Etag"),e.data)e.data[t].fields[y.currencySelected]&&(e.data[t].fields.price=e.data[t].fields[y.currencySelected],e.data[t].fields.price.currencyMask=-1<["ARS","MXN"].indexOf(y.currencySelected)?"$":"US$",a.push(e.data[t]),r.add(e.data[t].fields.name),g[s.COUNTRY][y.currencySelected].forEach(r.add,r));y.coinsData[n][o]=a},function(e){304!==e.status?y.coinsData[n][o].error=!0:y.coinsData[n][o].error=!1}).finally(function(){y.coinsData[n][o].loadingStatus="determinate"})}y.notExistsInBlockedProvidersList=function(e){return!p[s.COUNTRY][y.currencySelected].has(e)},y.addOrRemoveFromBlockedProviderList=function(e){y.notExistsInBlockedProvidersList(e)?p[s.COUNTRY][y.currencySelected].add(e):p[s.COUNTRY][y.currencySelected].delete(e)},y.getProviders=function(){return y.visibleFiltersDialog?Array.from(new Set(r.get().concat(Array.from(g[s.COUNTRY][y.currencySelected])))).sort():[]},y.anyProviderCheckedInFiltersDialog=function(){return p[s.COUNTRY][y.currencySelected].size==y.getProviders().length},y.doFilterProviders=function(){if(!Array.from(p[s.COUNTRY][y.currencySelected]).every(g[s.COUNTRY][y.currencySelected].has.bind(g[s.COUNTRY][y.currencySelected]))||0<g[s.COUNTRY][y.currencySelected].size&&0==p[s.COUNTRY][y.currencySelected].size||g[s.COUNTRY][y.currencySelected].size>p[s.COUNTRY][y.currencySelected].size){for(var e in g[s.COUNTRY][y.currencySelected]=new Set(p[s.COUNTRY][y.currencySelected]),l[s.COUNTRY])s.localStorage.setItem(s.COUNTRY+"_blocked_providers_"+l[s.COUNTRY][e],JSON.stringify(Array.from(g[s.COUNTRY][l[s.COUNTRY][e]])));y.updatePrices(void 0,!0)}o.hide()},y.changePriceDisabled=!1,y.whenChangeCurrency=function(e){u.push(e)},y.updatePrices=function(e,t){for(var a in _.clear(),b.clear(),t?ga("send","event","user_action","providers_filtered","Providers filtered",O().join()||"Unfiltered"):(e&&(y.currencySelected=e),ga("send","event","user_action","currency_change","Currency change",y.currencySelected),y.changePriceDisabled=!0,g[s.COUNTRY][y.currencySelected]=new Set(JSON.parse(s.localStorage.getItem(s.COUNTRY+"_blocked_providers_"+y.currencySelected))),p[s.COUNTRY][y.currencySelected]=new Set(JSON.parse(s.localStorage.getItem(s.COUNTRY+"_blocked_providers_"+y.currencySelected))),r.clear()),v={},c={},u)u[a]();t?(f=!0,C(function(){f=!1},1e3)):C(function(){y.changePriceDisabled=!1},2500),s.localStorage.setItem(s.COUNTRY+"_currency_selected",y.currencySelected)},y.btc_title="<i class='crypto-icon btc'></i> <h2>BITCOIN</h2>",y.eth_title="<i class='crypto-icon eth'></i> <h2>ETHEREUM</h2>",y.dai_title="<i class='crypto-icon dai'></i> <h2>DAI</h2>",y.usdc_title="<i class='crypto-icon usdc'></i> <h2>USDC</h2>",y.usdt_title="<i class='crypto-icon usdt'></i> <h2>USDT</h2>",y.coinsData={},y.specificRollData={};var N={body:"Hay una nueva oportunidad con $COIN.",icon:"/static/img/logo-web.png?v1"},h=new Set;function S(){y.rollsLoadingStatus="indeterminate",t.get(s.PRICES_ENDPOINT+"/"+s.COUNTRY+"/rolls/"+y.currencySelected+(0<O().length?"?not="+O().join():""),{headers:{"If-None-Match":v[y.currencySelected+O().join("")]}}).then(function(e){var t=[];v[y.currencySelected+O().join("")]=e.headers("Etag");var a="";for(c in Array.from(h))R(!1,Array.from(h)[c].toLowerCase());var n="",o=[];for(c in e.data){if(a!=e.data[c].k&&(a=e.data[c].k),e.data[c].buy.fields[y.currencySelected]&&e.data[c].sell.fields[y.currencySelected]){e.data[c].buy.fields.price=e.data[c].buy.fields[y.currencySelected],e.data[c].sell.fields.price=e.data[c].sell.fields[y.currencySelected],e.data[c].buy.fields.currencyMask=-1<["ARS","MXN"].indexOf(y.currencySelected)?"$":"US$",e.data[c].sell.fields.currencyMask=-1<["ARS","MXN"].indexOf(y.currencySelected)?"$":"US$";for(var r=!1,i=0;i<t.length&&!r;i++)t[i].k==a&&(r=!0);o[a]=o[a]||[],o[a].push(e.data[c]),r||t.push(e.data[c]),""!=n&&n!=a&&R(!0,n,o[n]),e.data.length-1==c&&R(!0,a,o[a])}else""!=n&&n!=a&&R(!1,n);n=a}if(y.rollsLoadingStatus="determinate",!window.IS_MOBILE){var l,c,s,d,u,f=new Set,g=new Set,p=new Set;for(c in h.forEach(p.add,p),t)if(p.delete(t[c].k.toUpperCase()),!y.customAlertsEnabled||y.customAlertsEnabled&&0<y.customAlertsConfig.coins.filter(function(e){return e.code==t[c].k.toUpperCase()&&e.selected}).length&&parseFloat(t[c].difference.replace(",","."))>=y.customAlertsConfig.profit){if(_.has(t[c].k.toUpperCase())&&b.has(t[c].k.toUpperCase()+"|"+t[c].buy.fields.name.toUpperCase()+"|"+t[c].sell.fields.name.toUpperCase()))b.has(t[c].k.toUpperCase()+"|"+t[c].buy.fields.name.toUpperCase()+"|"+t[c].sell.fields.name.toUpperCase())&&.5<=parseFloat(t[c].difference.replace(",","."))-b.get(t[c].k.toUpperCase()+"|"+t[c].buy.fields.name.toUpperCase()+"|"+t[c].sell.fields.name.toUpperCase())&&g.add(t[c].k.toUpperCase());else{_.add(t[c].k.toUpperCase()),f.add(t[c].k.toUpperCase());var m,S=Array.from(b.keys());for(m in S)S[m].substring(0,3)==t[c].k.toUpperCase()&&b.delete(S[m])}b.set(t[c].k.toUpperCase()+"|"+t[c].buy.fields.name.toUpperCase()+"|"+t[c].sell.fields.name.toUpperCase(),parseFloat(t[c].difference.replace(",",".")))}p.forEach(_.delete,_),document.hidden&&!window.IS_MOBILE&&"Notification"in window&&"granted"===Notification.permission&&y.alertsEnabled&&(0<f.size||0<g.size)&&(f.forEach(_.add,_),g.forEach(_.add,_),0<f.size&&(l="",c=1,u=JSON.parse(JSON.stringify(N)),f.forEach(function(e){2==c&&f.size==c?l+=" y "+e:2==c?l+=", "+e:1==c&&(l+=e),c++}),s=0,2==f.size?(s=1,u.body="Hay oportunidades con $COIN."):2<f.size&&(s=2,u.body="Hay oportunidades con $COIN y más."),u.body=u.body.replace("$COIN",l),new Notification(["📣","🎉","🥳"][s]+" Tenés una alerta",u).onclick=function(){window.focus(),ga("send","event","user_action","notification","Notification clicked","click")},d=[],b.forEach(function(e,t){d.push(t+"|"+e)}),ga("send","event","system_action","notification_sended","Notification sended",d.toString(","))),0<g.size&&((u=0)<f.size&&(u=1e4),C(function(){var t="",a=1,e=JSON.parse(JSON.stringify(N));g.forEach(function(e){2==a&&g.size==a?t+=" y "+e:2==a?t+=", "+e:1==a&&(t+=e),a++}),g.size<=2?e.body="Mejoró una oportunidad con $COIN.":2<g.size&&(e.body="Mejoró una oportunidad con $COIN y más."),e.body=e.body.replace("$COIN",t),new Notification(["💰","📈","🔥"][Math.floor(3*Math.random())]+" Aumentó el porcentaje de ganancia",e).onclick=function(){window.focus(),ga("send","event","user_action","notification","Notification clicked","click")}},u)))}},function(e){304!==e.status&&R(!1),y.rollsLoadingStatus="determinate"})}function R(e,t,a){if(t){for(var n in y.specificRollData[t]=y.specificRollData[t]||[],y.specificRollData[t])delete y.specificRollData[t][n].manuallySetted,y.specificRollData[t][n]=y.specificRollData[t][n]||{};if(a){for(var n in a)y.specificRollData[t][n]=y.specificRollData[t][n]||{},y.specificRollData[t][n].data=a[n],3.5<=parseFloat(y.specificRollData[t][n].data.difference.replace(",","."))&&y.specificRollData[t][n].data.buy.fields.score&&y.specificRollData[t][n].data.sell.fields.score&&3.5<=y.specificRollData[t][n].data.buy.fields.score.average_transfer_speed_rating&&3.5<=y.specificRollData[t][n].data.sell.fields.score.average_transfer_speed_rating?(y.specificRollData[t][n].score=3,y.trackSystem("unique_opportunity","show")):delete y.specificRollData[t][n].score;y.carouselDataByCoin[t].index>=y.specificRollData[t].length&&(y.carouselDataByCoin[t].index=0)}else delete y.specificRollData[t]}else if(!e){var o=Object.keys(y.specificRollData);for(n in o)delete y.specificRollData[o[n]]}}h.add("BTC"),h.add("ETH"),h.add("DAI"),h.add("USDC"),h.add("USDT");var A=!(y.showFiltersDialog=function(e){f||(y.visibleFiltersDialog=!0,o.show({contentElement:"#filters-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,onRemoving:function(){y.visibleFiltersDialog=!1}}))}),I=!1;y.showRollCalculatorDialog=function(e,t,a){I=A=!1,y.showCalculatorWarning=!1,ga("send","event","user_action","roll_calculator","Roll calculator opened","open_"+t+"_"+y.currencySelected),y.selectedCoinForRoll=t,y.rollCalculator={amount:("BTC"!=t.toUpperCase()&&"ETH"!=t.toUpperCase()?1e3*y.specificRollData[y.selectedCoinForRoll][a].data.buy.fields[y.currencySelected].ask:y.specificRollData[y.selectedCoinForRoll][a].data.buy.fields[y.currencySelected].ask).toString().replace(".",",")},y.calculatorRollData=Object.assign({},y.specificRollData[t][a]);var r=y.specificRollData[t][a].data.buy.fields.id+"-"+y.specificRollData[t][a].data.sell.fields.id,n=y.$watch("specificRollData[selectedCoinForRoll]",function(e,t){var a=!1,n=!1;if(e)for(var o in e)if(e[o].data.buy.fields.id+"-"+e[o].data.sell.fields.id==r){e=e[o],a=!0;break}if(e&&!a&&(e=void 0),t)for(var o in t)if(t[o].data.buy.fields.id+"-"+t[o].data.sell.fields.id==r){t=t[o],n=!0;break}t&&!n&&(t=void 0),e&&e.manuallySetted||e===t||(A||e&&(!e||e===t||e.data.buy.fields.name===t.data.buy.fields.name&&e.data.sell.fields.name===t.data.sell.fields.name)?A||I||e===t||e.data.buy.fields.name!==t.data.buy.fields.name||e.data.sell.fields.name!==t.data.sell.fields.name||e.data.buy.fields[y.currencySelected].ask===t.data.buy.fields[y.currencySelected].ask&&e.data.sell.fields[y.currencySelected].bid===t.data.sell.fields[y.currencySelected].bid||(I=!0,y.calculatorWarningText="Los precios que estás viendo están desactualizados.",y.calculatorWarningCTAText="ACTUALIZAR",y.calculatorWarningCTAAvailable=!0,y.showCalculatorWarning=!0):(A=!0,y.calculatorWarningText="Esta oportunidad ya no está disponible.",y.calculatorWarningCTAAvailable=!1,y.showCalculatorWarning=!0))},!0);y.selectedRollIndexNumber=a,o.show({contentElement:"#roll-calculator-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,onRemoving:function(){n()}})},y.updateValuesInRollCalculator=function(){y.calculatorWarningCTAAvailable&&(y.specificRollData[y.selectedCoinForRoll][y.selectedRollIndexNumber].manuallySetted=!0,y.calculatorRollData=Object.assign({},y.specificRollData[y.selectedCoinForRoll][y.selectedRollIndexNumber]),y.showCalculatorWarning=!1,I=!1)},y.getMinimumRollInversion=function(e){if(!e||!e.buy.fields[y.currencySelected]||!e.sell.fields[y.currencySelected])return!1;if(e){var t=1e6/e.buy.fields[y.currencySelected].ask*e.sell.fields[y.currencySelected].bid-1e6;return 1e6*(1e3+e.gas_costs)/t}},y.showAlertsPermissionDialog=function(e,t){(y.alertsForcedFiltersStep=t)?y.customizeAlerts():(y.step1Alerts=!0,y.step2Alerts=!1,y.step3Alerts=!1),o.show({contentElement:"#alerts-permission-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0})};var T={body:"¡Hola! Así se verán las notificaciones 😉",icon:"/static/img/logo-web.png?v1"},U={body:"Te mantendremos informado.",icon:"/static/img/logo-web.png?v1"};if(y.customAlertsEnabled)y.availableOptionsForAlerts=JSON.parse(s.localStorage.getItem("custom_alerts_config"))||{};else for(var w in y.availableOptionsForAlerts={coins:[],profit:void 0},Array.from(h))y.availableOptionsForAlerts.coins.push({code:Array.from(h)[w],selected:!1});function E(e,t,a){this._mdPanelRef=e,this.$timeout=t,this.$window=a}y.isCoinsIndeterminatedInAlertCustomization=function(){return 0<y.availableOptionsForAlerts.coins.filter(function(e){return e.selected}).length&&!y.allCoinsSelectedInAlertCustomization()},y.allCoinsSelectedInAlertCustomization=function(){return 0===y.availableOptionsForAlerts.coins.filter(function(e){return!e.selected}).length},y.anyCoinSelectedInCustomization=function(){return 0<y.availableOptionsForAlerts.coins.filter(function(e){return e.selected}).length},y.toggleAllCoinsInAlertCustomization=function(){y.allCoinsSelectedInAlertCustomization()?y.availableOptionsForAlerts.coins.forEach(function(e){e.selected=!1}):y.availableOptionsForAlerts.coins.filter(function(e){return!e.selected}).forEach(function(e){e.selected=!0})},y.customizeAlerts=function(){y.step1Alerts=!1,y.step2Alerts=!0,y.step3Alerts=!1},y.enableAlerts=function(){y.step1Alerts=!1,y.step2Alerts=!1,y.step3Alerts=!0,y.customAlertsConfig=y.availableOptionsForAlerts,s.localStorage.setItem("custom_alerts_config",angular.toJson(y.customAlertsConfig)),ga("send","event","user_action","notifications_configured","Notifications configured",y.customAlertsConfig.coins.filter(function(e){return e.selected}).map(function(e){return e.code}).toString(",")+"|"+y.customAlertsConfig.profit),"Notification"in window&&"granted"===Notification.permission?(y.cancelModal(),s.localStorage.getItem("custom_alerts_enabled")?y.alertsForcedFiltersStep?i.sendSnackbarAlert("¡Listo! Guardamos los cambios."):new Notification("¡Te damos la bienvenida!",T):new Notification("🎉 Ya tenés alertas personalizadas",U),y.alertsEnabled=!0,y.customAlertsEnabled=!0,s.localStorage.removeItem("generic_alerts_enabled"),s.localStorage.setItem("custom_alerts_enabled",!0),ga("send","event","user_action","notifications_change","Notifications configured","re_enabled_with_customization")):"Notification"in window&&"denied"!==Notification.permission&&Notification.requestPermission().then(function(e){"granted"===e?(y.cancelModal(),new Notification("¡Te damos la bienvenida!",T),y.alertsEnabled=!0,y.customAlertsEnabled=!0,s.localStorage.removeItem("generic_alerts_enabled"),s.localStorage.setItem("custom_alerts_enabled",!0),ga("send","event","user_action","notifications_change","Notifications configured","enabled_with_customization")):ga("send","event","user_action","notifications_change","Notifications configured","rejected_with_customization")})},y.disableAlerts=function(){y.cancelModal(),y.alertsEnabled=!1,y.customAlertsEnabled=!1,y.customAlertsConfig={},s.localStorage.setItem("generic_alerts_enabled",!1),s.localStorage.setItem("custom_alerts_enabled",!1),s.localStorage.removeItem("custom_alerts_config"),i.sendSnackbarAlert("Desactivaste las alertas.<br/>No volveremos a notificarte cuando haya nuevas oportunidades."),ga("send","event","user_action","notifications_change","Notifications configured","disabled")},y.cancelModal=function(){o.cancel()},E.$inject=["mdPanelRef","$timeout","$window"],E.prototype.$onInit=function(){this.$timeout(function(){var e=document.querySelector(".comparative-tables-menu-item.selected");(e?angular.element(e):angular.element(document.querySelectorAll(".comparative-tables-menu-item")[0])).focus()})},E.prototype.selectOption=function(e){this._mdPanelRef&&this._mdPanelRef.close().then(function(){s.location.href=e})},E.prototype.indexOf=function(e,t){for(var a,n=0;a=e[n];n++)if(a===t)return n;return-1},E.prototype.onMouseOver=function(e){angular.element(e.srcElement||e.target).focus()},E.prototype.onKeydown=function(e,t){var a,n;switch(e.which){case 38:(n=document.querySelectorAll(".comparative-tables-menu-item"))[(this.indexOf(n,document.activeElement)+n.length-1)%n.length].focus(),a=!0;break;case 40:(n=document.querySelectorAll(".comparative-tables-menu-item"))[(this.indexOf(n,document.activeElement)+1)%n.length].focus(),a=!0;break;case 13:case 32:this.selectOption(t),a=!0;break;case 9:this._mdPanelRef&&this._mdPanelRef.close()}a&&(e.preventDefault(),e.stopImmediatePropagation())},y.showComparativeTablesMenu=function(e,t,a){t=n.newPanelPosition().relativeTo(".comparative-tables-menu-button-"+t+"-"+a.fields.id).addPanelPosition(n.xPosition.ALIGN_START,n.yPosition.BELOW),e={attachTo:angular.element(document.body),controller:E,controllerAs:"ctrl",template:'<div class="comparative-tables-menu"      aria-label="Opciones del proveedor"      role="listbox">  <div class="comparative-tables-menu-item"        tabindex="-1"        role="option"        ng-repeat="option in ctrl.options"        ng-click="ctrl.selectOption(option.url)"       ng-mouseover="ctrl.onMouseOver($event)"       ng-keydown="ctrl.onKeydown($event, option.url)">    {{ option.text }}   </div></div>',position:t,locals:{options:[{text:"Ficha técnica",url:"/"+s.COUNTRY+"/comisiones-y-limites/"+("ripio-exchange"==a.fields.id?"ripio":a.fields.id)},{text:"Ver opiniones",url:"/"+s.COUNTRY+"/opiniones/"+("ripio-exchange"==a.fields.id?"ripio":a.fields.id)+"/"}]},openFrom:e,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!1,zIndex:10};n.open(e)},!window.IS_MOBILE&&"Notification"in window&&"granted"===Notification.permission&&y.alertsEnabled||(y.alertsEnabled=!1,s.localStorage.setItem("generic_alerts_enabled",!1));var D=["ask","bid"],k=[];!function(){for(var e in S(),s.AVAILABLE_COINS)for(var t in D)m(s.AVAILABLE_COINS[e],D[t]),k[s.AVAILABLE_COINS[e]+D[t]]={interval:d(function(e,t){m(e,t)},6e4,0,!0,s.AVAILABLE_COINS[e],D[t]),handled:!0},function(e,t){u.push(function(){m(e,t)})}(s.AVAILABLE_COINS[e],D[t]);var r,i,l=d(S,6e4),c=!0;document.addEventListener("visibilitychange",function(){for(var e in y.getAlertsEnabled()||(c=!0,d.cancel(l),C.cancel(r),document.hidden?c=!1:(l=d(S,6e4),r=C(S,500))),s.AVAILABLE_COINS){var t,a=s.AVAILABLE_COINS[e];for(t in D){var n=D[t];k[a+n]=k[a+n]||{};var o=k[a+n];o.handled=!0,d.cancel(o.interval),C.cancel(o.future_execution),document.hidden?o.handled=!1:(o.interval=d(function(e,t){m(e,t)},6e4,0,!0,a,n),o.future_execution=C(function(e,t){m(e,t)},500,!0,a,n))}}}),window.addEventListener("focus",function(){for(var e in y.getAlertsEnabled()||(C.cancel(i),i=C(function(){c||(d.cancel(l),C.cancel(r),l=d(S,6e4),r=C(S,1),c=!0)},499)),s.AVAILABLE_COINS){var t,a=s.AVAILABLE_COINS[e];for(t in D){var n=D[t];k[a+n]=k[a+n]||{};var o=k[a+n];C.cancel(o.focusTimeout),o.focusTimeout=C(function(){o.handled||(d.cancel(o.interval),C.cancel(o.future_execution),o.interval=d(function(e,t){m(e,t)},6e4,0,!0,a,n),o.future_execution=C(function(e,t){m(e,t)},1,!0,a,n))},499)}}})}()}]).filter("makePositive",function(){return function(e){return Math.abs(e)}}).directive("sanitizeCalculatorInput",function(){return{require:"ngModel",link:function(e,t,a,n){e.$watch(a.ngModel,function(e){null!=e&&(n.$setViewValue(String(e).replace(/,/g,".").replace(/\$/g,"").substring(0,9)),t.val(String(e).replace(/,/g,".").replace(/\$/g,"").substring(0,9)))})}}}).directive("input",function(){return{restrict:"E",require:"ngModel",link:function(e,t,a,n){"number"===t[0].type&&(n.$parsers.push(function(e){return Number(e)}),n.$formatters.push(function(e){return parseFloat(e,10)}))}}});