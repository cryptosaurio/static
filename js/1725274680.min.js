angular.module("app",["ngSanitize","ngMaterial","ngMessages","ngMdIcons","ngclipboard","angular.snackbar","tooltips"]).config(["$provide","$compileProvider","$mdThemingProvider","$sceDelegateProvider",function(e,t,a,n){t.debugInfoEnabled(!1),a.disableTheming(!0),e.decorator("$locale",["$delegate",function(e){return e.NUMBER_FORMATS.DECIMAL_SEP=",",e.NUMBER_FORMATS.GROUP_SEP=".",e}]),e.decorator("$exceptionHandler",["$delegate",function(a){return function(e,t){a(e,t),reportError(JSON.stringify({exception:"object"==typeof e?e.stack:""+e,cause:""+t}))}}]),n.resourceUrlWhitelist(["https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@**","**/partials/*","**/static/**"])}]);var e=angular.module("app");e.service("providersService",function(){var t=new Set;this.get=function(){return Array.from(t).sort()},this.add=function(e){t.add(e)},this.delete=function(e){t.delete(e)},this.clear=function(){t.clear()}}),(e=angular.module("app")).controller("MainController",["$scope","$window","$q","$http","$interval","$timeout","$mdDialog","$animate","providersService","commonFunctionsService",function(g,p,e,t,s,m,n,a,o,r){g.tooltipCopySuccessful=r.tooltipCopySuccessful,g.track=r.track,g.trackSystem=r.trackSystem,a.enabled(angular.element(document.getElementById("roll-calculator-dialog")),!1),g.redirectTo=function(e){p.location.href=e};g.currencySelected=-1<["ARS","USD"].indexOf(p.localStorage.getItem("currency_selected"))?p.localStorage.getItem("currency_selected"):p.localStorage.removeItem("currency_selected")||"ARS";var d=[C];g.visibleFiltersDialog=!1;var S={},i={},l=!1,y=new Set,v=new Map;g.IS_MOBILE=window.IS_MOBILE,g.customAlertsConfig=JSON.parse(p.localStorage.getItem("custom_alerts_config"))||{},g.customAlertsEnabled=!!JSON.parse(p.localStorage.getItem("custom_alerts_enabled"))&&!angular.equals(g.customAlertsConfig,{})||!1,g.getCustomAlertText=function(){if(g.getAlertsEnabled()){var e,t=[];for(e in g.customAlertsConfig.coins)g.customAlertsConfig.coins[e].selected&&t.push(g.customAlertsConfig.coins[e].code);var a="";1<t.length?(a=t.slice(0,-1).join(", "),a+=" y "+t.slice(-1)[0]):a=t[0];var n="TenÃ©s alertas configuradas.";return g.customAlertsEnabled&&(n="TenÃ©s una alerta para "+a+" desde "+g.customAlertsConfig.profit.replace(".",",")+"% de ganancia."),n}return""},g.alertsEnabled=!!JSON.parse(p.localStorage.getItem("generic_alerts_enabled"))||g.customAlertsEnabled||!1,g.getAlertsEnabled=function(){return g.alertsEnabled},g.alertsPermissionGrantedInThePast="Notification"in window&&"granted"===Notification.permission,g.rollsLoadingStatus="indeterminate",g.maxDecimalsPerCoin={BTC:7,ETH:7,DAI:2,USDC:2,USDT:2};var c=[];c.ARS=new Set,c.USD=new Set;try{c.ARS=new Set(JSON.parse(p.localStorage.getItem("blocked_providers_ars")))}catch(e){p.localStorage.setItem("blocked_providers_ars",JSON.stringify([]))}try{c.USD=new Set(JSON.parse(p.localStorage.getItem("blocked_providers_usd")))}catch(e){p.localStorage.setItem("blocked_providers_usd",JSON.stringify([]))}g.appliedFiltersText=function(){return 0<c[g.currencySelected].size?" ("+c[g.currencySelected].size+")":""};var u=[];u.ARS=new Set,u.USD=new Set;try{u.ARS=new Set(JSON.parse(p.localStorage.getItem("blocked_providers_ars")))}catch(e){p.localStorage.setItem("blocked_providers_ars",JSON.stringify([]))}try{u.USD=new Set(JSON.parse(p.localStorage.getItem("blocked_providers_usd")))}catch(e){p.localStorage.setItem("blocked_providers_usd",JSON.stringify([]))}function b(){return Array.from(c[g.currencySelected]).sort()}function f(n,r){return g.coinsData[n]=g.coinsData[n]||{},g.coinsData[n][r]=g.coinsData[n][r]||{},g.coinsData[n][r].loadingStatus="indeterminate",t.get(p.PRICES_ENDPOINT+"/prices/"+g.currencySelected+"/"+n+"/"+r+(0<b().length?"?not="+b().join():""),{headers:{"If-None-Match":i[n+r+g.currencySelected+b().join("")]}}).then(function(e){var t,a=[];for(t in i[n+r+g.currencySelected+b().join("")]=e.headers("Etag"),e.data)e.data[t].fields[g.currencySelected]&&(e.data[t].fields.price=e.data[t].fields[g.currencySelected],e.data[t].fields.price.currencyMask="ARS"==g.currencySelected?"$":"US$",a.push(e.data[t]),o.add(e.data[t].fields.name),c[g.currencySelected].forEach(o.add,o));g.coinsData[n][r]=a},function(e){304!==e.status?g.coinsData[n][r].error=!0:g.coinsData[n][r].error=!1}).finally(function(){g.coinsData[n][r].loadingStatus="determinate"})}g.notExistsInBlockedProvidersList=function(e){return!u[g.currencySelected].has(e)},g.addOrRemoveFromBlockedProviderList=function(e){g.notExistsInBlockedProvidersList(e)?u[g.currencySelected].add(e):u[g.currencySelected].delete(e)},g.getProviders=function(){return g.visibleFiltersDialog?Array.from(new Set(o.get().concat(Array.from(c[g.currencySelected])))).sort():[]},g.anyProviderCheckedInFiltersDialog=function(){return u[g.currencySelected].size==g.getProviders().length},g.doFilterProviders=function(){(!Array.from(u[g.currencySelected]).every(c[g.currencySelected].has.bind(c[g.currencySelected]))||0<c[g.currencySelected].size&&0==u[g.currencySelected].size||c[g.currencySelected].size>u[g.currencySelected].size)&&(c[g.currencySelected]=new Set(u[g.currencySelected]),p.localStorage.setItem("blocked_providers_ars",JSON.stringify(Array.from(c.ARS))),p.localStorage.setItem("blocked_providers_usd",JSON.stringify(Array.from(c.USD))),g.updatePrices(void 0,!0)),n.hide()},g.changePriceDisabled=!1,g.whenChangeCurrency=function(e){d.push(e)},g.updatePrices=function(e,t){for(var a in y.clear(),v.clear(),t?p.gtag("event","providers_filtered",{event_category:"user_action",event_label:b().join()||"Unfiltered"}):(e&&(g.currencySelected=e),p.gtag("event","currency_change",{event_category:"user_action",event_label:g.currencySelected}),g.changePriceDisabled=!0,c[g.currencySelected]=new Set(JSON.parse(p.localStorage.getItem("blocked_providers_"+g.currencySelected.toLowerCase()))),u[g.currencySelected]=new Set(JSON.parse(p.localStorage.getItem("blocked_providers_"+g.currencySelected.toLowerCase()))),o.clear()),S={},i={},d)d[a]();t?(l=!0,m(function(){l=!1},1e3)):m(function(){g.changePriceDisabled=!1},2500),p.localStorage.setItem("currency_selected",g.currencySelected)},g.btc_title="<i class='crypto-icon btc'></i> <h2>BITCOIN</h2>",g.eth_title="<i class='crypto-icon eth'></i> <h2>ETHEREUM</h2>",g.dai_title="<i class='crypto-icon dai'></i> <h2>DAI</h2>",g.usdc_title="<i class='crypto-icon usdc'></i> <h2>USDC</h2>",g.usdt_title="<i class='crypto-icon usdt'></i> <h2>USDT</h2>",g.coinsData={},g.specificRollData={};var _={body:"Hay una nueva oportunidad con $COIN.",icon:"/static/img/logo-navidad-web.png?v1"},h=new Set;function C(){g.rollsLoadingStatus="indeterminate",t.get(p.PRICES_ENDPOINT+"/rolls/"+g.currencySelected+(0<b().length?"?not="+b().join():""),{headers:{"If-None-Match":S[g.currencySelected+b().join("")]}}).then(function(e){var t=[];S[g.currencySelected+b().join("")]=e.headers("Etag");var a="";for(r in Array.from(h))A(!1,Array.from(h)[r].toLowerCase());for(r in e.data)a!=e.data[r].k&&(a=e.data[r].k),e.data[r].buy.fields[g.currencySelected]&&e.data[r].sell.fields[g.currencySelected]?(e.data[r].buy.fields.price=e.data[r].buy.fields[g.currencySelected],e.data[r].sell.fields.price=e.data[r].sell.fields[g.currencySelected],e.data[r].buy.fields.currencyMask="ARS"==g.currencySelected?"$":"US$",e.data[r].sell.fields.currencyMask="ARS"==g.currencySelected?"$":"US$",t.push(e.data[r]),A(!0,a,e.data[r])):A(!1,a);if(g.rollsLoadingStatus="determinate",!window.IS_MOBILE){var n,r,o,i,l,c=new Set,s=new Set,d=new Set;for(r in h.forEach(d.add,d),t)if(d.delete(t[r].k.toUpperCase()),!g.customAlertsEnabled||g.customAlertsEnabled&&0<g.customAlertsConfig.coins.filter(function(e){return e.code==t[r].k.toUpperCase()&&e.selected}).length&&parseFloat(t[r].difference.replace(",","."))>=g.customAlertsConfig.profit){if(y.has(t[r].k.toUpperCase())&&v.has(t[r].k.toUpperCase()+"|"+t[r].buy.fields.name.toUpperCase()+"|"+t[r].sell.fields.name.toUpperCase()))v.has(t[r].k.toUpperCase()+"|"+t[r].buy.fields.name.toUpperCase()+"|"+t[r].sell.fields.name.toUpperCase())&&.5<=parseFloat(t[r].difference.replace(",","."))-v.get(t[r].k.toUpperCase()+"|"+t[r].buy.fields.name.toUpperCase()+"|"+t[r].sell.fields.name.toUpperCase())&&s.add(t[r].k.toUpperCase());else{y.add(t[r].k.toUpperCase()),c.add(t[r].k.toUpperCase());var u,f=Array.from(v.keys());for(u in f)f[u].substring(0,3)==t[r].k.toUpperCase()&&v.delete(f[u])}v.set(t[r].k.toUpperCase()+"|"+t[r].buy.fields.name.toUpperCase()+"|"+t[r].sell.fields.name.toUpperCase(),parseFloat(t[r].difference.replace(",",".")))}d.forEach(y.delete,y),document.hidden&&!window.IS_MOBILE&&"Notification"in window&&"granted"===Notification.permission&&g.alertsEnabled&&(0<c.size||0<s.size)&&(c.forEach(y.add,y),s.forEach(y.add,y),0<c.size&&(n="",r=1,l=JSON.parse(JSON.stringify(_)),c.forEach(function(e){2==r&&c.size==r?n+=" y "+e:2==r?n+=", "+e:1==r&&(n+=e),r++}),o=0,2==c.size?(o=1,l.body="Hay oportunidades con $COIN."):2<c.size&&(o=2,l.body="Hay oportunidades con $COIN y mÃ¡s."),l.body=l.body.replace("$COIN",n),new Notification(["ðŸ“£","ðŸŽ‰","ðŸ¥³"][o]+" TenÃ©s una alerta",l).onclick=function(){window.focus(),p.gtag("event","notification",{event_category:"user_action",event_label:"click"})},i=[],v.forEach(function(e,t){i.push(t+"|"+e)}),p.gtag("event","notification_sended",{event_category:"system_action",event_label:i.toString(",")})),0<s.size&&((l=0)<c.size&&(l=1e4),m(function(){var t="",a=1,e=JSON.parse(JSON.stringify(_));s.forEach(function(e){2==a&&s.size==a?t+=" y "+e:2==a?t+=", "+e:1==a&&(t+=e),a++}),s.size<=2?e.body="MejorÃ³ una oportunidad con $COIN.":2<s.size&&(e.body="MejorÃ³ una oportunidad con $COIN y mÃ¡s."),e.body=e.body.replace("$COIN",t),new Notification(["ðŸ’°","ðŸ“ˆ","ðŸ”¥"][Math.floor(3*Math.random())]+" AumentÃ³ el porcentaje de ganancia",e).onclick=function(){window.focus(),p.gtag("event","notification",{event_category:"user_action",event_label:"click"})}},l)))}},function(e){304!==e.status&&A(!1),g.rollsLoadingStatus="determinate"})}function A(e,t,a){if(t)g.specificRollData[t]&&delete g.specificRollData[t].manuallySetted,g.specificRollData[t]=g.specificRollData[t]||{},g.specificRollData[t].show=e,a&&(g.specificRollData[t].data=a,3.5<=parseFloat(g.specificRollData[t].data.difference.replace(",","."))&&g.specificRollData[t].data.buy.fields.score&&g.specificRollData[t].data.sell.fields.score&&3.5<=g.specificRollData[t].data.buy.fields.score.average_transfer_speed_rating&&3.5<=g.specificRollData[t].data.sell.fields.score.average_transfer_speed_rating&&(g.specificRollData[t].score=3,g.trackSystem("unique_opportunity","show")));else if(!e){var n,r=Object.keys(g.specificRollData);for(n in r)delete g.specificRollData[r[n]]}}h.add("BTC"),h.add("ETH"),h.add("DAI"),h.add("USDC"),h.add("USDT");var w=!(g.showFiltersDialog=function(e){l||(g.visibleFiltersDialog=!0,n.show({contentElement:"#filters-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,onRemoving:function(){g.visibleFiltersDialog=!1}}))}),I=!1;g.showRollCalculatorDialog=function(e,t){I=w=!1,g.showCalculatorWarning=!1,p.gtag("event","roll_calculator",{event_category:"user_action",event_label:"open_"+t+"_"+g.currencySelected}),g.selectedCoinForRoll=t,g.rollCalculator={amount:("BTC"!=t.toUpperCase()&&"ETH"!=t.toUpperCase()?1e3*g.specificRollData[g.selectedCoinForRoll].data.buy.fields[g.currencySelected].ask:g.specificRollData[g.selectedCoinForRoll].data.buy.fields[g.currencySelected].ask).toString().replace(".",",")},g.calculatorRollData=Object.assign({},g.specificRollData[t]);var a=g.$watch("specificRollData[selectedCoinForRoll]",function(e,t){e&&e.manuallySetted||e===t||(w||e&&(!e||e===t||e.data.buy.fields.name===t.data.buy.fields.name&&e.data.sell.fields.name===t.data.sell.fields.name)?w||I||e===t||e.data.buy.fields.name!==t.data.buy.fields.name||e.data.sell.fields.name!==t.data.sell.fields.name||e.data.buy.fields[g.currencySelected].ask===t.data.buy.fields[g.currencySelected].ask&&e.data.sell.fields[g.currencySelected].bid===t.data.sell.fields[g.currencySelected].bid||(I=!0,g.calculatorWarningText="Los precios que estÃ¡s viendo estÃ¡n desactualizados.",g.calculatorWarningCTAText="ACTUALIZAR",g.calculatorWarningCTAAvailable=!0,g.showCalculatorWarning=!0):(w=!0,g.calculatorWarningText="Esta oportunidad ya no estÃ¡ disponible.",g.calculatorWarningCTAAvailable=!1,g.showCalculatorWarning=!0))},!0);n.show({contentElement:"#roll-calculator-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0,onRemoving:function(){a()}})},g.updateValuesInRollCalculator=function(){g.calculatorWarningCTAAvailable&&(g.specificRollData[g.selectedCoinForRoll].manuallySetted=!0,g.calculatorRollData=Object.assign({},g.specificRollData[g.selectedCoinForRoll]),g.showCalculatorWarning=!1,I=!1)},g.getMinimumRollInversion=function(e){if(!e||!e.buy.fields[g.currencySelected]||!e.sell.fields[g.currencySelected])return!1;if(e){var t=1e6/e.buy.fields[g.currencySelected].ask*e.sell.fields[g.currencySelected].bid-1e6;return 1e6*(1e3+e.gas_costs)/t}},g.showAlertsPermissionDialog=function(e,t){(g.alertsForcedFiltersStep=t)?g.customizeAlerts():(g.step1Alerts=!0,g.step2Alerts=!1,g.step3Alerts=!1),n.show({contentElement:"#alerts-permission-dialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,escapeToClose:!0,fullscreen:!0})};var E={body:"Â¡Hola! AsÃ­ se verÃ¡n las notificaciones ðŸ˜‰",icon:"/static/img/logo-navidad-web.png?v1"},D={body:"Te mantendremos informado.",icon:"/static/img/logo-navidad-web.png?v1"};if(g.customAlertsEnabled)g.availableOptionsForAlerts=JSON.parse(p.localStorage.getItem("custom_alerts_config"))||{};else for(var k in g.availableOptionsForAlerts={coins:[],profit:void 0},Array.from(h))g.availableOptionsForAlerts.coins.push({code:Array.from(h)[k],selected:!1});g.isCoinsIndeterminatedInAlertCustomization=function(){return 0<g.availableOptionsForAlerts.coins.filter(function(e){return e.selected}).length&&!g.allCoinsSelectedInAlertCustomization()},g.allCoinsSelectedInAlertCustomization=function(){return 0===g.availableOptionsForAlerts.coins.filter(function(e){return!e.selected}).length},g.anyCoinSelectedInCustomization=function(){return 0<g.availableOptionsForAlerts.coins.filter(function(e){return e.selected}).length},g.toggleAllCoinsInAlertCustomization=function(){g.allCoinsSelectedInAlertCustomization()?g.availableOptionsForAlerts.coins.forEach(function(e){e.selected=!1}):g.availableOptionsForAlerts.coins.filter(function(e){return!e.selected}).forEach(function(e){e.selected=!0})},g.customizeAlerts=function(){g.step1Alerts=!1,g.step2Alerts=!0,g.step3Alerts=!1},g.enableAlerts=function(){g.step1Alerts=!1,g.step2Alerts=!1,g.step3Alerts=!0,g.customAlertsConfig=g.availableOptionsForAlerts,p.localStorage.setItem("custom_alerts_config",angular.toJson(g.customAlertsConfig)),p.gtag("event","notifications_configured",{event_category:"user_action",event_label:g.customAlertsConfig.coins.filter(function(e){return e.selected}).map(function(e){return e.code}).toString(",")+"|"+g.customAlertsConfig.profit}),"Notification"in window&&"granted"===Notification.permission?(g.cancelModal(),p.localStorage.getItem("custom_alerts_enabled")?g.alertsForcedFiltersStep?r.sendSnackbarAlert("Â¡Listo! Guardamos los cambios."):new Notification("Â¡Te damos la bienvenida!",E):new Notification("ðŸŽ‰ Ya tenÃ©s alertas personalizadas",D),g.alertsEnabled=!0,g.customAlertsEnabled=!0,p.localStorage.removeItem("generic_alerts_enabled"),p.localStorage.setItem("custom_alerts_enabled",!0),p.gtag("event","notifications_change",{event_category:"user_action",event_label:"re_enabled_with_customization"})):"Notification"in window&&"denied"!==Notification.permission&&Notification.requestPermission().then(function(e){"granted"===e?(g.cancelModal(),new Notification("Â¡Te damos la bienvenida!",E),g.alertsEnabled=!0,g.customAlertsEnabled=!0,p.localStorage.removeItem("generic_alerts_enabled"),p.localStorage.setItem("custom_alerts_enabled",!0),p.gtag("event","notifications_change",{event_category:"user_action",event_label:"enabled_with_customization"})):p.gtag("event","notifications_change",{event_category:"user_action",event_label:"rejected_with_customization"})})},g.disableAlerts=function(){g.cancelModal(),g.alertsEnabled=!1,g.customAlertsEnabled=!1,g.customAlertsConfig={},p.localStorage.setItem("generic_alerts_enabled",!1),p.localStorage.setItem("custom_alerts_enabled",!1),p.localStorage.removeItem("custom_alerts_config"),r.sendSnackbarAlert("Desactivaste las alertas.<br/>No volveremos a notificarte cuando haya nuevas oportunidades."),p.gtag("event","notifications_change",{event_category:"user_action",event_label:"disabled"})},g.cancelModal=function(){n.cancel()},!window.IS_MOBILE&&"Notification"in window&&"granted"===Notification.permission&&g.alertsEnabled||(g.alertsEnabled=!1,p.localStorage.setItem("generic_alerts_enabled",!1));var O=["btc","eth","dai","usdc","usdt"],N=["ask","bid"],R=[];!function(){for(var e in C(),O)for(var t in N)f(O[e],N[t]),R[O[e]+N[t]]={interval:s(function(e,t){f(e,t)},6e4,0,!0,O[e],N[t]),handled:!0},function(e,t){d.push(function(){f(e,t)})}(O[e],N[t]);var o,i,l=s(C,6e4),c=!0;document.addEventListener("visibilitychange",function(){for(var e in g.getAlertsEnabled()||(c=!0,s.cancel(l),m.cancel(o),document.hidden?c=!1:(l=s(C,6e4),o=m(C,500))),O){var t,a=O[e];for(t in N){var n=N[t];R[a+n]=R[a+n]||{};var r=R[a+n];r.handled=!0,s.cancel(r.interval),m.cancel(r.future_execution),document.hidden?r.handled=!1:(r.interval=s(function(e,t){f(e,t)},6e4,0,!0,a,n),r.future_execution=m(function(e,t){f(e,t)},500,!0,a,n))}}}),window.addEventListener("focus",function(){for(var e in g.getAlertsEnabled()||(m.cancel(i),i=m(function(){c||(s.cancel(l),m.cancel(o),l=s(C,6e4),o=m(C,1),c=!0)},499)),O){var t,a=O[e];for(t in N){var n=N[t];R[a+n]=R[a+n]||{};var r=R[a+n];m.cancel(r.focusTimeout),r.focusTimeout=m(function(){r.handled||(s.cancel(r.interval),m.cancel(r.future_execution),r.interval=s(function(e,t){f(e,t)},6e4,0,!0,a,n),r.future_execution=m(function(e,t){f(e,t)},1,!0,a,n))},499)}}})}()}]).filter("makePositive",function(){return function(e){return Math.abs(e)}}).directive("sanitizeCalculatorInput",function(){return{require:"ngModel",link:function(e,t,a,n){e.$watch(a.ngModel,function(e){null!=e&&(n.$setViewValue(String(e).replace(/,/g,".").replace(/\$/g,"").substring(0,9)),t.val(String(e).replace(/,/g,".").replace(/\$/g,"").substring(0,9)))})}}}).directive("input",function(){return{restrict:"E",require:"ngModel",link:function(e,t,a,n){"number"===t[0].type&&(n.$parsers.push(function(e){return Number(e)}),n.$formatters.push(function(e){return parseFloat(e,10)}))}}});